<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì° Gu√≠a de Conexi√≥n Sensor HW-511</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">
                <i class="fas fa-satellite-dish text-blue-600"></i>
                Gu√≠a de Conexi√≥n Sensor HW-511
            </h1>
            <p class="text-lg text-gray-600">Paso a paso para conectar tu sensor infrarrojo</p>
        </div>

        <!-- Paso 1: Hardware -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-bold text-blue-600 mb-4">
                <span class="bg-blue-600 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-2">1</span>
                Conexi√≥n del Hardware
            </h2>
            
            <div class="space-y-4">
                <div class="border-l-4 border-blue-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">üìå Pines del Sensor HW-511:</h3>
                    <ul class="space-y-2">
                        <li class="flex items-center">
                            <span class="bg-red-500 text-white px-3 py-1 rounded mr-3 font-mono">VCC</span>
                            <span>‚Üí Conectar a <strong>3.3V</strong> del NodeMCU</span>
                        </li>
                        <li class="flex items-center">
                            <span class="bg-black text-white px-3 py-1 rounded mr-3 font-mono">GND</span>
                            <span>‚Üí Conectar a <strong>GND</strong> del NodeMCU</span>
                        </li>
                        <li class="flex items-center">
                            <span class="bg-green-500 text-white px-3 py-1 rounded mr-3 font-mono">OUT</span>
                            <span>‚Üí Conectar a <strong>D2</strong> del NodeMCU</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <p class="text-sm">
                        <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                        <strong>IMPORTANTE:</strong> Usa 3.3V, NO 5V (puede da√±ar el NodeMCU)
                    </p>
                </div>

                <div class="bg-gray-100 rounded-lg p-4">
                    <h4 class="font-bold mb-2">üîß Diagrama de Conexi√≥n:</h4>
                    <pre class="text-sm font-mono bg-white p-4 rounded border">
NodeMCU          HW-511
=======          ======
3.3V    ------>  VCC (Rojo)
GND     ------>  GND (Negro)
D2      ------>  OUT (Verde/Amarillo)
                    </pre>
                </div>
            </div>
        </div>

        <!-- Paso 2: C√≥digo Arduino -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-bold text-green-600 mb-4">
                <span class="bg-green-600 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-2">2</span>
                Subir C√≥digo al NodeMCU
            </h2>

            <div class="space-y-4">
                <div class="border-l-4 border-green-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">üìù Instrucciones:</h3>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>Abre el <strong>Arduino IDE</strong></li>
                        <li>Selecciona <strong>Herramientas ‚Üí Placa ‚Üí NodeMCU 1.0 (ESP-12E Module)</strong></li>
                        <li>Selecciona el <strong>Puerto COM</strong> correcto</li>
                        <li>Copia el c√≥digo de abajo</li>
                        <li>Haz clic en <strong>Subir</strong> (‚Üí)</li>
                    </ol>
                </div>

                <div class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto">
                    <pre class="text-sm">
// ===== C√ìDIGO NODEMCU PARA SENSOR HW-511 V15 STABLE =====
const int sensorPin = D2;      // Pin del sensor
const int ledPin = LED_BUILTIN; // LED integrado

bool lastState = HIGH;
unsigned long lastTime = 0;

void setup() {
  // Inicializar comunicaci√≥n serial
  Serial.begin(115200);
  
  // Configurar pines
  pinMode(sensorPin, INPUT_PULLUP);
  pinMode(ledPin, OUTPUT);
  digitalWrite(ledPin, HIGH); // LED apagado (HIGH = apagado en NodeMCU)
  
  // Esperar estabilizaci√≥n
  delay(2000);
  
  Serial.println("Sistema V15 STABLE listo para detectar sensor");
  Serial.flush();
  delay(500);
  Serial.println("NodeMCU inicializado correctamente");
  Serial.flush();
}

void loop() {
  // Leer estado actual del sensor
  bool currentState = digitalRead(sensorPin);
  
  // Detectar cambio de HIGH a LOW (objeto detectado)
  if (currentState == LOW && lastState == HIGH) {
    // Anti-rebote: solo procesar si pasaron m√°s de 300ms
    if (millis() - lastTime > 300) {
      // Enviar "click" por serial
      Serial.println("click");
      Serial.flush(); // Env√≠o inmediato
      
      // Parpadear LED para feedback visual
      digitalWrite(ledPin, LOW);  // Encender
      delay(100);
      digitalWrite(ledPin, HIGH); // Apagar
      
      lastTime = millis();
    }
  }
  
  lastState = currentState;
  
  // Procesar comandos desde la aplicaci√≥n web
  if (Serial.available()) {
    String cmd = Serial.readStringUntil('\n');
    cmd.trim();
    
    if (cmd == "TEST_SENSOR") {
      // Simular activaci√≥n del sensor
      Serial.println("click");
      Serial.flush();
      digitalWrite(ledPin, LOW);
      delay(200);
      digitalWrite(ledPin, HIGH);
      Serial.println("Prueba completada");
      Serial.flush();
    }
    else if (cmd == "STATUS") {
      // Reportar estado actual
      Serial.print("Sensor estado: ");
      Serial.println(digitalRead(sensorPin) ? "HIGH" : "LOW");
      Serial.print("LED estado: ");
      Serial.println(digitalRead(ledPin) ? "OFF" : "ON");
      Serial.flush();
    }
  }
  
  delay(10); // Peque√±o delay para estabilidad
}
                    </pre>
                </div>

                <button onclick="copiarCodigo()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg">
                    <i class="fas fa-copy mr-2"></i>
                    Copiar C√≥digo
                </button>
            </div>
        </div>

        <!-- Paso 3: Verificaci√≥n -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-bold text-purple-600 mb-4">
                <span class="bg-purple-600 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-2">3</span>
                Verificar Funcionamiento
            </h2>

            <div class="space-y-4">
                <div class="border-l-4 border-purple-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">üîç Prueba del Sensor (sin aplicaci√≥n):</h3>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>Abre <strong>Monitor Serie</strong> (Herramientas ‚Üí Monitor Serie)</li>
                        <li>Configura velocidad a <strong>115200 baudios</strong></li>
                        <li>Deber√≠as ver: <code class="bg-gray-100 px-2 py-1 rounded">"Sistema V15 STABLE listo para detectar sensor"</code></li>
                        <li><strong>Pasa tu mano</strong> frente al sensor HW-511</li>
                        <li>Deber√≠as ver: <code class="bg-green-100 px-2 py-1 rounded text-green-700">"click"</code></li>
                        <li>El LED del NodeMCU deber√≠a <strong>parpadear</strong></li>
                    </ol>
                </div>

                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <p class="text-sm">
                        <i class="fas fa-check-circle text-green-600"></i>
                        <strong>¬øFunciona en el Monitor Serie?</strong> ¬°Perfecto! Ya puedes usarlo con la aplicaci√≥n.
                    </p>
                </div>

                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <p class="text-sm">
                        <i class="fas fa-times-circle text-red-600"></i>
                        <strong>¬øNo funciona?</strong> Revisa la secci√≥n de soluci√≥n de problemas abajo.
                    </p>
                </div>
            </div>
        </div>

        <!-- Paso 4: Conectar a la Aplicaci√≥n -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-bold text-orange-600 mb-4">
                <span class="bg-orange-600 text-white rounded-full w-8 h-8 inline-flex items-center justify-center mr-2">4</span>
                Conectar a la Aplicaci√≥n Web
            </h2>

            <div class="space-y-4">
                <div class="border-l-4 border-orange-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">üåê Pasos en la Aplicaci√≥n:</h3>
                    <ol class="list-decimal list-inside space-y-2">
                        <li><strong>Cierra el Monitor Serie</strong> del Arduino IDE (importante)</li>
                        <li>Abre <strong>index.html</strong> en Chrome o Edge</li>
                        <li>Haz clic en <strong>"Conectar NodeMCU V15 STABLE por USB"</strong></li>
                        <li>Selecciona el puerto COM del NodeMCU en el di√°logo</li>
                        <li>Espera a ver: <span class="bg-green-100 px-2 py-1 rounded text-green-700">‚úÖ NodeMCU conectado!</span></li>
                        <li>Haz clic en <strong>"üß™ Probar"</strong> para verificar</li>
                        <li>Deber√≠as ver el contador de clicks aumentar</li>
                        <li>¬°Ahora puedes jugar activando el sensor f√≠sico!</li>
                    </ol>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-bold mb-2">üéÆ Para Jugar:</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚úÖ Conexi√≥n OK</li>
                            <li>‚úÖ Sensor detectando clicks</li>
                            <li>‚úÖ LED parpadeando</li>
                            <li>‚úÖ Contador aumentando</li>
                        </ul>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-bold mb-2">‚ö†Ô∏è Recuerda:</h4>
                        <ul class="text-sm space-y-1">
                            <li>‚Ä¢ Cerrar Monitor Serie</li>
                            <li>‚Ä¢ Usar Chrome/Edge</li>
                            <li>‚Ä¢ Ventana normal (no iframe)</li>
                            <li>‚Ä¢ NodeMCU conectado por USB</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Soluci√≥n de Problemas -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
            <h2 class="text-2xl font-bold text-red-600 mb-4">
                <i class="fas fa-wrench"></i>
                Soluci√≥n de Problemas
            </h2>

            <div class="space-y-4">
                <div class="border-l-4 border-red-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">‚ùå Problema: No detecta nada en Monitor Serie</h3>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li>Verifica las conexiones f√≠sicas (VCC, GND, OUT)</li>
                        <li>Aseg√∫rate de usar <strong>3.3V</strong>, no 5V</li>
                        <li>Revisa que el cable USB sea de datos (no solo de carga)</li>
                        <li>Prueba otro puerto USB de tu computadora</li>
                        <li>Verifica velocidad de 115200 baudios en Monitor Serie</li>
                    </ul>
                </div>

                <div class="border-l-4 border-orange-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">‚ö†Ô∏è Problema: Detecta pero no se ve en la app</h3>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li><strong>Cierra el Monitor Serie del Arduino IDE</strong></li>
                        <li>Solo un programa puede usar el puerto serial a la vez</li>
                        <li>Refresca la p√°gina web y reconecta</li>
                    </ul>
                </div>

                <div class="border-l-4 border-yellow-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">‚ö†Ô∏è Problema: Sensor muy sensible o poco sensible</h3>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li>El HW-511 tiene un potenci√≥metro ajustable</li>
                        <li>G√≠ralo con un destornillador peque√±o para ajustar sensibilidad</li>
                        <li>Prueba diferentes distancias (5-30cm)</li>
                    </ul>
                </div>

                <div class="border-l-4 border-blue-500 pl-4">
                    <h3 class="font-bold text-lg mb-2">üí° Problema: Web Serial API no disponible</h3>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li>Usa <strong>Chrome</strong> o <strong>Edge</strong> (Firefox no soporta Web Serial)</li>
                        <li>Abre el archivo directamente, no en iframe</li>
                        <li>Si es necesario, usa un servidor local (Live Server en VSCode)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Test Interactivo -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg shadow-lg p-8 text-white">
            <h2 class="text-2xl font-bold mb-4">
                <i class="fas fa-vial"></i>
                Test R√°pido del Sensor
            </h2>
            <p class="mb-4">Haz clic para probar si tu NodeMCU est√° listo:</p>
            
            <div class="space-y-3">
                <a href="index.html" class="block bg-white text-blue-600 hover:bg-blue-50 font-bold py-3 px-6 rounded-lg text-center transition-colors">
                    <i class="fas fa-play-circle mr-2"></i>
                    Abrir Aplicaci√≥n de Juego
                </a>
                
                <div class="bg-white/20 rounded-lg p-4">
                    <h3 class="font-bold mb-2">‚úÖ Checklist Final:</h3>
                    <ul class="space-y-1 text-sm">
                        <li>‚òê Hardware conectado correctamente</li>
                        <li>‚òê C√≥digo subido al NodeMCU</li>
                        <li>‚òê Sensor detecta en Monitor Serie</li>
                        <li>‚òê Monitor Serie cerrado</li>
                        <li>‚òê Chrome o Edge abierto</li>
                        <li>‚òê Listo para conectar en la app</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Info Adicional -->
        <div class="mt-8 text-center text-gray-600 text-sm">
            <p>
                <i class="fas fa-info-circle"></i>
                <strong>Versi√≥n 15 STABLE</strong> - C√≥digo probado y funcionando
            </p>
            <p class="mt-2">
                ¬øNecesitas ayuda? Revisa los logs de conexi√≥n en la aplicaci√≥n
            </p>
        </div>
    </div>

    <script>
        function copiarCodigo() {
            const codigo = document.querySelector('.bg-gray-900 pre').textContent;
            navigator.clipboard.writeText(codigo).then(() => {
                alert('‚úÖ C√≥digo copiado al portapapeles!\n\nAhora p√©galo en el Arduino IDE y s√∫belo al NodeMCU.');
            }).catch(() => {
                alert('‚ùå No se pudo copiar autom√°ticamente.\nPor favor, selecciona y copia el c√≥digo manualmente.');
            });
        }
    </script>
</body>
</html>
